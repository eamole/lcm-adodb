{
  "version": 3,
  "file": "db.js",
  "sourceRoot": "",
  "sources": [
    "db.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "ADODB = require('node-adodb');\r\n\r\n# ADO constants\r\nadodb :\r\n  schemaEnum :\r\n    columns : 4\r\n    indexes : 12\r\n    procedures : 16\r\n    tables : 20\r\n    providerTypes : 22\r\n    views : 23\r\n    foreignKeys : 27\r\n    primaryKeys : 28\r\n    members : 38\r\n\r\n  typeEnum :\r\n    empty : 0\r\n    smallInt : 2\r\n    integer : 3\r\n    single : 4\r\n    double : 5\r\n    currency : 6\r\n    date : 7\r\n    bstr : 8\r\n    idispatch : 9\r\n    error : 10\r\n    boolean : 11\r\n    variant : 12\r\n    iunknown : 13\r\n    decimal : 14\r\n    tinyInt : 15\r\n    unsignedTinyInt : 16\r\n\r\nclass Db\r\n  constructor : (@name,@path,@password,@ext=\".mdb\") ->\r\n    @passString = \"\"\r\n    @passString = \"Jet OLEDB:Database Password=#{@password}\" if @password?\r\n    @file = @path + @ext\r\n    @provider = 'Provider=Microsoft.ACE.OLEDB.12.0'\r\n    @tables=[];\r\n    @dataSource = \"Data Source=#{@file}\"\r\n    @connected = false;\r\n    @cache = new JsonCache \"storage/db/#{@name}/\" , \"tables\" , @getTables\r\n\r\n  connect : ->\r\n    cnnString = \"#{@provider};#{@dataSource};#{@passString}\"\r\n    @cnn = ADODB.open cnnString\r\n    @connected=true;\r\n\r\n  getTable : (name) ->\r\n    console.log \"table [#{name} not found in database.tables\" if not @tables[name]?\r\n    table = @tables[name]\r\n\r\n  # kludge - should return a promise!! - instead using a callback!! needs to be bound\r\n  getTables : (cb) =>           # fat - used as a static callback\r\n    @connect() if not @connected\r\n    @cnn.schema 20\r\n      .then (@schema) =>  # fat for @ in promise\r\n        for tableObj in @schema\r\n          table = @addTable tableObj['TABLE_NAME']\r\n#          table.getFields()\r\n      .then ->\r\n        cb(); # TODO : cb kludge - should be promise\r\n      .catch (e) ->\r\n        console.log \"getTables Error : #{e} \"\r\n\r\n  # single query retuirns all fields, which give you all tables as well\r\n  getFields : (cb) ->\r\n    @connect() if not @connected\r\n    @db.cnn.schema 4 , [null,null,null]\r\n      .then (@schema) =>  # fat for @ in promise\r\n        for fieldObj in @schema\r\n          tableName = tableObj['TABLE_NAME']\r\n          # check if already exists\r\n          table = @addTable @ , tableName if not @tables[tableName]?\r\n          table = @tables[tableName]\r\n          table.addField fieldObj\r\n\r\n      .then ->\r\n        cb(); # TODO : cb kludge - should be promise\r\n      .catch (e) ->\r\n        console.log \"getFields Error : #{e} \"\r\n\r\n  addTable : (name) ->\r\n    table = new Table(@,name)\r\n    @tables[name] = table\r\n    table\r\n\r\nclass Table\r\n  constructor : (@db,@name) ->\r\n    @fields=[]\r\n\r\n  dump : ->\r\n    console.log \"Hello from table #{@name}\"\r\n\r\n  getFields : ->\r\n    @db.cnn.schema 4 , [null,null,@name]\r\n      .then (@schema) =>  # fat for @ in promise\r\n        for column in @schema\r\n          @addField column\r\n      .catch (e) ->\r\n        console.log \"getFields Error : #{e}\"\r\n\r\n  addField : (column) ->\r\n    field = new Field @,column\r\n    @fields[field.name]=field\r\n    field\r\n\r\n\r\nclass Field\r\n  constructor : (@table,@column) ->\r\n    try\r\n      @name = @column['COLUMN_NAME']\r\n      @itype = @column['DATA_TYPE']\r\n    catch e\r\n      console.log \"Field Error : #{e}\"\r\nmodule.exports = Db\r\n"
  ]
}